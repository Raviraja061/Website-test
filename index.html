<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Selection System - CYGNII</title>
    <link rel="stylesheet" href="style.css"> </head>
    <!-- Firebase SDKs -->
<!-- Firebase Compat SDKs (Correct for your use case) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>


<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDYI9D0cpUXyeejsWIKsOLyPIW7NV7LoI0",
    authDomain: "cygnii-solar-45.firebaseapp.com",
    projectId: "cygnii-solar-45",
    storageBucket: "cygnii-solar-45.firebasestorage.app",
    messagingSenderId: "209900063736",
    appId: "1:209900063736:web:c5a4171aae9eed7853a40d",
    measurementId: "G-XF30NYDHZZ"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
</script>

<body>
<div class="container">
    <div class="header">
        <img src="CYGNII_Website.jpg" alt="CYGNII Logo">
        <h1 id="main-title">CYGNII SOLAR</h1>
        <p id="main-subtitle">Step-by-step process</p>
    </div>

    <div class="progress-bar">
        <div class="progress" id="progress"></div>
    </div>

    <div id="language-page" class="page active">
        <h2 class="section-title" id="language-title">Select Language</h2>
        <div class="languages">
            <button class="btn btn-te" onclick="selectLanguage('te')">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
            <button class="btn" onclick="selectLanguage('en')">English</button>
        </div>

        <button class="next-btn" onclick="goToPage('auth-page', 33.33)">Continue</button>
    </div>

    <div id="auth-page" class="page">
        <div id="login-form">
            <h2 class="section-title" id="login-title">Login to Your Account</h2>
            <form onsubmit="event.preventDefault(); login();"> <div class="form-group">
                <label for="login-email" id="email-label">Email Address</label>
                <input type="email" id="login-email" placeholder="Enter your email" required>
            </div>
                <div class="form-group">
                    <label for="login-password" id="password-label">Password</label>
                    <input type="password" id="login-password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="form-btn" id="login-btn">Login</button>
            </form>
            <div class="switch-auth">
                <p id="no-account">Don't have an account? <a onclick="showRegister()" id="register-link">Register here</a></p>
            </div>
        </div>

        <div id="register-form" style="display: none;">
            <h2 class="section-title" id="register-title">Create Account</h2>
            <form onsubmit="event.preventDefault(); register();"> <div class="form-group">
                <label for="name" id="name-label">Full Name</label>
                <input type="text" id="name" placeholder="Enter your full name" required>
            </div>
                <div class="form-group">
                    <label for="phone" id="phone-label">Phone Number</label>
                    <input type="tel" id="phone" placeholder="Enter your phone number" required>
                </div>
                <div class="form-group">
                    <label for="email" id="reg-email-label">Email Address</label>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="password" id="reg-password-label">Password</label>
                    <input type="password" id="password" placeholder="Create a password" required>
                </div>
                <div class="form-group">
                    <label for="confirm-password" id="confirm-label">Confirm Password</label>
                    <input type="password" id="confirm-password" placeholder="Confirm your password" required>
                </div>
                <button type="submit" class="form-btn" id="register-btn">Register</button>
            </form>
            <div class="switch-auth">
                <p id="have-account">Already have an account? <a onclick="showLogin()" id="login-link">Login here</a></p>
            </div>
        </div>

        <div class="nav-controls">
            <button class="prev-btn" onclick="goToPage('language-page', 0)">Back</button>
        </div>
        <div class="admin-link">
            <a href="#" onclick="showAdminPrompt()" id="admin-link-guest">Guest Admin Access (for testing)</a>
        </div>
    </div>

<div id="home-page" class="page">
  <div class="top-bar">
    <button class="user-btn" onclick="toggleUserDetails()">üë§</button>
    <div id="user-details" class="user-details">
      <p><strong>Name:</strong> <span id="user-name"></span></p>
      <p><strong>Email:</strong> <span id="user-email"></span></p>
      <p><strong>Phone:</strong> <span id="user-phone"></span></p>
      <button class="logout-btn" onclick="logoutCustomer()">Logout</button>
    </div>
  </div>


  <h2 class="section-title">Welcome to CYGNII</h2>
  <div class="main-options home-options">
  <div class="option-with-sub">
  <div class="option-btn">Solar ‚ñæ</div>
  <div class="sub-options-menu">
    <div class="sub-option-btn" onclick="goToPage('solar-page', 100)">Solar Rooftop</div>
    <div class="sub-option-btn" onclick="alert('Coming Soon')">Solar Fencing</div>
  </div>
</div>

  <div class="option-btn">Supply</div>
  <div class="option-btn">Service</div>
</div>

</div>
<div id="solar-page" class="page">
  <h2 class="section-title">Solar Page</h2>
  <div class="main-options home-options">

    <!-- Home with Dropdown -->
    <div class="option-with-sub" onmouseover="showSubOptions(this)" onmouseout="hideSubOptions(this)">
      <div class="option-btn">Home</div>
      <div class="sub-options-menu">
        <div class="sub-option-btn" onclick="alert('PM Surya Ghar selected')">PM SURYA GHAR</div>
        <div class="sub-option-btn" onclick="alert('NON-DCR selected')">NON-DCR</div>
      </div>
    </div>

    <!-- Other Options -->
    <div class="option-btn" onclick="alert('Commercial Selected')">Commercial</div>
    <div class="option-btn" onclick="alert('Engineering Selected')">Engineering</div>

  </div>
<div class="nav-controls">
  <button class="back-btn" onclick="goToPage('home-page', 100)">‚Üê Back to Home</button>
</div>

</div>

   <div class="footer">
  <p>Email: <a href="mailto:cygniisolar@gmail.com">cygniisolar@gmail.com</a> | Phone: 8328001860</p>
  <p>¬© 2023 CYGNII Property Selection System | All Rights Reserved</p>
</div>
       

<script>
    // Current language
    let currentLanguage = localStorage.getItem('userLanguage') || 'en';
    let currentUserRole = localStorage.getItem('userRole') || null;

    // Mock backend data (in a real app, this would come from API calls)
    // This is stored here so the customer side can access it without a separate backend
    // In a real app, customer would fetch this from the backend
    let mockPlantCosts = JSON.parse(localStorage.getItem('plantCosts')) || [
        { id: 1, capacity: 1, cost: 91000 },
        { id: 2, capacity: 2, cost: 161000 },
        { id: 3, capacity: 3, cost: 220000 },
        { id: 4, capacity: 4, cost: 290000 }, // Example for custom 4kW
        { id: 5, capacity: 5, cost: 350000 }  // Example for custom 5kW
    ];

    // Ensure mockPlantCosts is saved to localStorage so admin changes persist
    function saveMockPlantCosts() {
        localStorage.setItem('plantCosts', JSON.stringify(mockPlantCosts));
    }
    // Save initial state if not already present
    if (!localStorage.getItem('plantCosts')) {
        saveMockPlantCosts();
    }

    // --- Translations object ---
    const translations = {
        en: {
            title: "Property Selection System",
            subtitle: "Step-by-step process",
            languageTitle: "Select Language",
            loginTitle: "Login to Your Account",
            registerTitle: "Create Account",
            propertyTitle: "Select Property Type",
            emailLabel: "Email Address",
            passwordLabel: "Password",
            nameLabel: "Full Name",
            phoneLabel: "Phone Number",
            confirmLabel: "Confirm Password",
            noAccount: "Don't have an account?",
            haveAccount: "Already have an account?",
            registerLink: "Register here",
            loginLink: "Login here",
            loginBtn: "Login",
            registerBtn: "Register",
            house: "House",
            commercial: "Commercial",
            service: "Service",
            subTitle: "Select House Type:",
            pmSuryaGahr: "PM Surya Gahr",
            nonDcr: "Non DCR",
            adminLinkGuest: "Guest Admin Access (for testing)",
            backLogin: "Back to Login",
            continueBtn: "Continue",
            logoutBtn: "Logout",
            houseSelected: "You selected: House",
            commercialSelected: "You selected: Commercial",
            serviceSelected: "You selected: Service",
            pmSuryaGahrSelected: "You selected: House ‚Üí PM Surya Gahr",
            nonDcrSelected: "You selected: House ‚Üí Non DCR",
            documentsTitle: "Documents Required",
            documentsNote: "All documents should belong to the same person whose name is on the current bill",
            doc1: "Aadhar Card",
            doc2: "PAN Card",
            doc3: "Bank Pass Book",
            doc4: "4 Months Current Bill",
            doc5: "Aadhar Linked Mobile Number",
            subsidyTitle: "Subsidy",
            plantCostTitle: "Plant Cost",
            plantCapacityHeader: "Plant Capacity",
            subsidyAmountHeader: "Subsidy Amount",
            costHeader: "Cost",
            customKwLabel: "Custom Plant Size (4-9 kW):",
            customCostLabel: "Custom Cost:",
            // Messages
            enterEmailPass: "Please enter email and password",
            passwordsMismatch: "Passwords do not match",
            fillAllFields: "Please fill all fields",
            registrationSuccess: "Registration successful! Logging in...",
            loginFailed: "Login failed. Please check your credentials.",
            invalidEmailPass: "Invalid email or password",
            loginError: "An error occurred during login.",
            registrationError: "An error occurred during registration.",
            adminAccessGranted: "Access granted! Redirecting to admin page...",
            invalidAccessCode: "Invalid access code",
            errorFetchingCosts: "Error fetching plant costs."
        },
        te: {
            title: "‡∞Ü‡∞∏‡±ç‡∞§‡∞ø ‡∞é‡∞Ç‡∞™‡∞ø‡∞ï ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡±ç‡∞•",
            subtitle: "‡∞¶‡∞∂‡∞≤ ‡∞µ‡∞æ‡∞∞‡±Ä ‡∞™‡±ç‡∞∞‡∞ï‡±ç‡∞∞‡∞ø‡∞Ø",
            languageTitle: "‡∞≠‡∞æ‡∞∑‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø",
            loginTitle: "‡∞Æ‡±Ä ‡∞ñ‡∞æ‡∞§‡∞æ‡∞≤‡±ã‡∞ï‡∞ø ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç ‡∞Ö‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø",
            registerTitle: "‡∞ñ‡∞æ‡∞§‡∞æ ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
            propertyTitle: "‡∞Ü‡∞∏‡±ç‡∞§‡∞ø ‡∞∞‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø",
            emailLabel: "‡∞á‡∞Æ‡±Ü‡∞Ø‡∞ø‡∞≤‡±ç ‡∞ö‡∞ø‡∞∞‡±Å‡∞®‡∞æ‡∞Æ‡∞æ",
            passwordLabel: "‡∞™‡∞æ‡∞∏‡±ç‡∞µ‡∞∞‡±ç‡∞°‡±ç",
            nameLabel: "‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞™‡±á‡∞∞‡±Å",
            phoneLabel: "‡∞´‡±ã‡∞®‡±ç ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç",
            confirmLabel: "‡∞™‡∞æ‡∞∏‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞°‡±ç‚Äå‡∞®‡∞ø ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
            noAccount: "‡∞ñ‡∞æ‡∞§‡∞æ ‡∞≤‡±á‡∞¶‡∞æ?",
            haveAccount: "‡∞á‡∞™‡±ç‡∞™‡∞ü‡∞ø‡∞ï‡±á ‡∞ñ‡∞æ‡∞§‡∞æ ‡∞â‡∞Ç‡∞¶‡∞æ?",
            registerLink: "‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞∏‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø",
            loginLink: "‡∞á‡∞ï‡±ç‡∞ï‡∞° ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç ‡∞Ö‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø",
            loginBtn: "‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç",
            registerBtn: "‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞∏‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø",
            house: "‡∞π‡±å‡∞∏‡±ç",
            commercial: "‡∞ï‡∞æ‡∞Æ‡∞∞‡±ç‡∞∑‡∞ø‡∞Ø‡∞≤‡±ç",
            service: "‡∞∏‡±á‡∞µ",
            subTitle: "‡∞π‡±å‡∞∏‡±ç ‡∞∞‡∞ï‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø:",
            pmSuryaGahr: "‡∞™‡∞ø‡∞é‡∞Ç ‡∞∏‡±Ç‡∞∞‡±ç‡∞Ø ‡∞ó‡±É‡∞π‡∞Ç",
            nonDcr: "‡∞®‡∞æ‡∞®‡±ç ‡∞°‡∞ø‡∞∏‡∞ø‡∞Ü‡∞∞‡±ç",
            adminLinkGuest: "‡∞Ö‡∞§‡∞ø‡∞•‡∞ø ‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞®‡±ç ‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡±ç (‡∞™‡∞∞‡±Ä‡∞ï‡±ç‡∞∑ ‡∞ï‡±ã‡∞∏‡∞Ç)",
            backLogin: "‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç‚Äå‡∞ï‡±Å ‡∞§‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø ‡∞µ‡±Ü‡∞≥‡±ç‡∞≥‡∞Ç‡∞°‡∞ø",
            continueBtn: "‡∞ï‡±ä‡∞®‡∞∏‡∞æ‡∞ó‡∞ø‡∞Ç‡∞ö‡±Å",
            logoutBtn: "‡∞≤‡∞æ‡∞ó‡±å‡∞ü‡±ç",
            houseSelected: "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å: ‡∞π‡±å‡∞∏‡±ç",
            commercialSelected: "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å: ‡∞ï‡∞æ‡∞Æ‡∞∞‡±ç‡∞∑‡∞ø‡∞Ø‡∞≤‡±ç",
            serviceSelected: "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å: ‡∞∏‡±á‡∞µ",
            pmSuryaGahrSelected: "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å: ‡∞π‡±å‡∞∏‡±ç ‚Üí ‡∞™‡∞ø‡∞é‡∞Ç ‡∞∏‡±Ç‡∞∞‡±ç‡∞Ø ‡∞ó‡±É‡∞π‡∞Ç",
            nonDcrSelected: "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡±Å: ‡∞π‡±å‡∞∏‡±ç ‚Üí ‡∞®‡∞æ‡∞®‡±ç ‡∞°‡∞ø‡∞∏‡∞ø‡∞Ü‡∞∞‡±ç",
            documentsTitle: "‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Æ‡±à‡∞® ‡∞°‡∞æ‡∞ï‡±ç‡∞Ø‡±Å‡∞Æ‡±Ü‡∞Ç‡∞ü‡±ç‡∞∏‡±ç",
            documentsNote: "‡∞à ‡∞°‡∞æ‡∞ï‡±ç‡∞Ø‡±Å‡∞Æ‡±Ü‡∞Ç‡∞ü‡±ç‡∞∏‡±ç ‡∞Ö‡∞®‡±ç‡∞®‡±Ä ‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞¨‡∞ø‡∞≤‡±ç‡∞≤‡±Å‡∞≤‡±ã ‡∞™‡±á‡∞∞‡±Å ‡∞â‡∞®‡±ç‡∞® ‡∞µ‡±ç‡∞Ø‡∞ï‡±ç‡∞§‡∞ø‡∞ï‡∞ø ‡∞ö‡±Ü‡∞Ç‡∞¶‡∞ø‡∞®‡∞µ‡∞ø",
            doc1: "‡∞Ü‡∞ß‡∞æ‡∞∞‡±ç ‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±Å",
            doc2: "‡∞™‡∞æ‡∞®‡±ç ‡∞ï‡∞æ‡∞∞‡±ç‡∞°‡±Å",
            doc3: "‡∞¨‡±ç‡∞Ø‡∞æ‡∞Ç‡∞ï‡±ç ‡∞™‡∞æ‡∞∏‡±ç ‡∞¨‡±Å‡∞ï‡±ç",
            doc4: "4 ‡∞®‡±Ü‡∞≤‡∞≤ ‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞¨‡∞ø‡∞≤‡±ç‡∞≤‡±Å",
            doc5: "‡∞Ü‡∞ß‡∞æ‡∞∞‡±ç ‡∞≤‡∞ø‡∞Ç‡∞ï‡±ç ‡∞Æ‡±ä‡∞¨‡±à‡∞≤‡±ç ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç",
            subsidyTitle: "‡∞∏‡∞¨‡±ç‡∞∏‡∞ø‡∞°‡±Ä",
            plantCostTitle: "‡∞™‡±ç‡∞≤‡∞æ‡∞Ç‡∞ü‡±ç ‡∞ñ‡∞∞‡±ç‡∞ö‡±Å",
            plantCapacityHeader: "‡∞™‡±ç‡∞≤‡∞æ‡∞Ç‡∞ü‡±ç ‡∞∏‡∞æ‡∞Æ‡∞∞‡±ç‡∞•‡±ç‡∞Ø‡∞Ç",
            subsidyAmountHeader: "‡∞∏‡∞¨‡±ç‡∞∏‡∞ø‡∞°‡±Ä ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç",
            costHeader: "‡∞ñ‡∞∞‡±ç‡∞ö‡±Å",
            customKwLabel: "‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡±ç ‡∞™‡±ç‡∞≤‡∞æ‡∞Ç‡∞ü‡±ç ‡∞∏‡±à‡∞ú‡±Å (4-9 kW):",
            customCostLabel: "‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡±ç ‡∞ñ‡∞∞‡±ç‡∞ö‡±Å:",
            // Messages
            enterEmailPass: "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞á‡∞Æ‡±Ü‡∞Ø‡∞ø‡∞≤‡±ç ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞™‡∞æ‡∞∏‡±ç‡∞µ‡∞∞‡±ç‡∞°‡±ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
            passwordsMismatch: "‡∞™‡∞æ‡∞∏‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞°‡±ç‚Äå‡∞≤‡±Å ‡∞∏‡∞∞‡∞ø‡∞™‡±ã‡∞≤‡∞≤‡±á‡∞¶‡±Å",
            fillAllFields: "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞´‡±Ä‡∞≤‡±ç‡∞°‡±ç‚Äå‡∞≤‡∞®‡±Å ‡∞™‡±Ç‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
            registrationSuccess: "‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø! ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...",
            loginFailed: "‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç ‡∞µ‡∞ø‡∞´‡∞≤‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡±Ä ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞æ‡∞≤‡∞®‡±Å ‡∞§‡∞®‡∞ø‡∞ñ‡±Ä ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.",
            invalidEmailPass: "‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞®‡∞ø ‡∞á‡∞Æ‡±Ü‡∞Ø‡∞ø‡∞≤‡±ç ‡∞≤‡±á‡∞¶‡∞æ ‡∞™‡∞æ‡∞∏‡±ç‚Äå‡∞µ‡∞∞‡±ç‡∞°‡±ç",
            loginError: "‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç‚Äå‡∞≤‡±ã ‡∞≤‡±ã‡∞™‡∞Ç ‡∞è‡∞∞‡±ç‡∞™‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.",
            registrationError: "‡∞®‡∞Æ‡±ã‡∞¶‡±Å‡∞≤‡±ã ‡∞≤‡±ã‡∞™‡∞Ç ‡∞è‡∞∞‡±ç‡∞™‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø.",
            adminAccessGranted: "‡∞™‡±ç‡∞∞‡∞µ‡±á‡∞∂‡∞Ç ‡∞Ö‡∞®‡±Å‡∞Æ‡∞§‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø! ‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞®‡±ç ‡∞™‡±á‡∞ú‡±Ä‡∞ï‡∞ø ‡∞Æ‡∞≥‡±ç‡∞≤‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...",
            invalidAccessCode: "‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞®‡∞ø ‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡±ç ‡∞ï‡±ã‡∞°‡±ç",
            errorFetchingCosts: "‡∞™‡±ç‡∞≤‡∞æ‡∞Ç‡∞ü‡±ç ‡∞ß‡∞∞‡∞≤‡∞®‡±Å ‡∞™‡±ä‡∞Ç‡∞¶‡∞°‡∞Ç‡∞≤‡±ã ‡∞≤‡±ã‡∞™‡∞Ç ‡∞è‡∞∞‡±ç‡∞™‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø."
        }
    };

    // Update UI based on selected language
    function updateUIForLanguage(lang) {
    const langData = translations[lang] || translations.en;

    // Only update elements that actually exist in the DOM
    const setText = (id, value) => {
        const el = document.getElementById(id);
        if (el) el.textContent = value;
    };

    const setHTML = (id, html) => {
        const el = document.getElementById(id);
        if (el) el.innerHTML = html;
    };

    setText('main-title', langData.title);
    setText('main-subtitle', langData.subtitle);
    setText('language-title', langData.languageTitle);
    setText('login-title', langData.loginTitle);
    setText('register-title', langData.registerTitle);
    setText('email-label', langData.emailLabel);
    setText('password-label', langData.passwordLabel);
    setText('name-label', langData.nameLabel);
    setText('phone-label', langData.phoneLabel);
    setText('reg-email-label', langData.emailLabel);
    setText('reg-password-label', langData.passwordLabel);
    setText('confirm-label', langData.confirmLabel);

    setHTML('no-account', `${langData.noAccount} <a onclick="showRegister()">${langData.registerLink}</a>`);
    setHTML('have-account', `${langData.haveAccount} <a onclick="showLogin()">${langData.loginLink}</a>`);

    setText('login-btn', langData.loginBtn);
    setText('register-btn', langData.registerBtn);
    setText('admin-link-guest', langData.adminLinkGuest);

    const backBtn = document.querySelector('.nav-controls .prev-btn');
    if (backBtn) backBtn.textContent = langData.backLogin;

    const nextLangBtn = document.querySelector('#language-page .next-btn');
    if (nextLangBtn) nextLangBtn.textContent = langData.continueBtn;
}

function goToPage(pageId, progress) {
        // Hide all pages
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
        });

        // Show the selected page
        document.getElementById(pageId).classList.add('active');

        // Update progress bar
        document.getElementById('progress').style.width = progress + '%';

        // Scroll to top
        window.scrollTo(0, 0);

        // Specific action after navigating to property page
        if (pageId === 'property-page' && currentUserRole === 'customer') {
            fetchAndDisplayPlantCostsForCustomer(); // Refresh costs for customer view
        }
    }

    // Language selection
    function selectLanguage(lang) {
        localStorage.setItem('userLanguage', lang);
        currentLanguage = lang;
        updateUIForLanguage(lang);
    }

    // Initialize language and check role on load
    document.addEventListener('DOMContentLoaded', () => {
        updateUIForLanguage(currentLanguage);

        // If already logged in and role is admin, redirect to admin page
        if (currentUserRole === 'admin') {
            window.location.href = 'admin.html';
            return; // Stop further execution for this page
        }

        // If on property page (e.g., direct access after login/refresh) and a customer, load costs
        if (document.getElementById('property-page').classList.contains('active') && currentUserRole === 'customer') {
            fetchAndDisplayPlantCostsForCustomer();
        }
    });

    // Page navigation
    

    // Show register form
    function showRegister() {
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('register-form').style.display = 'block';
    }

    // Show login form
    function showLogin() {
        document.getElementById('register-form').style.display = 'none';
        document.getElementById('login-form').style.display = 'block';
    }

    // Login function
    async function login() {
  const email = document.getElementById('login-email').value;
  const password = document.getElementById('login-password').value;

  if (email && password) {
    try {
      // Firebase login
      const userCredential = await auth.signInWithEmailAndPassword(email, password);
      const user = userCredential.user;

      // Get user role from Firestore
      const doc = await db.collection("users").doc(user.uid).get();
      const userData = doc.data();

      if (!userData) {
        alert("User data not found in Firestore");
        return;
      }

      localStorage.setItem('userRole', userData.role);
      currentUserRole = userData.role;

      if (userData.role === 'admin') {
        window.location.href = 'admin.html';
      } else {
        goToPage('home-page', 100);
showUserDataInHomePage();

      }

    } catch (error) {
      console.error('Login error:', error);
      alert(error.message || translations[currentLanguage].loginError);
    }
  } else {
    alert(translations[currentLanguage].enterEmailPass);
  }
}

                // --- END MOCK LOGIN LOGIC ---

         

    // Register function
    async function register() {
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirm-password').value;

  if (password !== confirmPassword) {
    alert(translations[currentLanguage].passwordsMismatch);
    return;
  }

  if (name && phone && email && password) {
    try {
      // Firebase registration
      const userCredential = await auth.createUserWithEmailAndPassword(email, password);
      const user = userCredential.user;

      // Store extra details in Firestore
      await db.collection("users").doc(user.uid).set({
        name,
        phone,
        email,
        role: "customer"
      });

      alert(translations[currentLanguage].registrationSuccess);
      showLogin();

    } catch (error) {
      console.error('Registration error:', error);
      alert(error.message || translations[currentLanguage].registrationError);
    }
  } else {
    alert(translations[currentLanguage].fillAllFields);
  }
}


  

    // Admin access function (for guest access testing - not main login path)
    function showAdminPrompt() {
        const prompts = {
            en: "Enter admin access code:",
            te: "‡∞Ö‡∞°‡±ç‡∞Æ‡∞ø‡∞®‡±ç ‡∞Ø‡∞æ‡∞ï‡±ç‡∞∏‡±Ü‡∞∏‡±ç ‡∞ï‡±ã‡∞°‡±ç‚Äå‡∞®‡∞ø ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø:"
        };

        const code = prompt(prompts[currentLanguage]);
        if(code === "1234") { // Hardcoded code for guest admin access
            localStorage.setItem('userRole', 'admin'); // Set role to admin
            alert(translations[currentLanguage].adminAccessGranted);
            window.location.href = 'admin.html'; // Redirect to admin page
        } else {
            alert(translations[currentLanguage].invalidAccessCode);
        }
    }

    // Logout function for customer
    function logoutCustomer() {
        localStorage.removeItem('userRole'); // Clear role
        // In a real app: localStorage.removeItem('authToken'); // Clear any authentication tokens
        alert(currentLanguage === 'te' ? "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Ç‡∞ó‡∞æ ‡∞≤‡∞æ‡∞ó‡±å‡∞ü‡±ç ‡∞Ö‡∞Ø‡±ç‡∞Ø‡∞æ‡∞∞‡±Å." : "You have been logged out successfully.");
        window.location.href = 'index.html'; // Redirect to login page
    }
function toggleUserDetails() {
    const panel = document.getElementById("user-details");
    panel.style.display = panel.style.display === "block" ? "none" : "block";
}
function showSubOptions(element) {
  const menu = element.querySelector('.sub-options-menu');
  if (menu) menu.style.display = 'block';
}

function hideSubOptions(element) {
  const menu = element.querySelector('.sub-options-menu');
  if (menu) menu.style.display = 'none';
}

function showUserDataInHomePage() {
    const uid = auth.currentUser?.uid;
    if (!uid) return;

    db.collection("users").doc(uid).get().then(doc => {
        if (doc.exists) {
            const data = doc.data();
            document.getElementById("user-name").textContent = data.name || "";
            document.getElementById("user-email").textContent = data.email || "";
            document.getElementById("user-phone").textContent = data.phone || "";
        }
    }).catch(error => {
        console.error("Error fetching user details for home page:", error);
    });
}
</script>


</body>
</html>

